<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Random Forest Model with Cross-Validation and Feature Importance • SENDQSAR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Random Forest Model with Cross-Validation and Feature Importance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SENDQSAR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/get_compile_data.html">get_compile_data</a></li>
    <li><a class="dropdown-item" href="../articles/get_bw_score.html">get_bw_score</a></li>
    <li><a class="dropdown-item" href="../articles/get_livertobw_score.html">get_livertobw_score</a></li>
    <li><a class="dropdown-item" href="../articles/get_lb_score.html">get_lb_score</a></li>
    <li><a class="dropdown-item" href="../articles/get_mi_score.html">get_mi_score</a></li>
    <li><a class="dropdown-item" href="../articles/get_liver_om_lb_mi_tox_score_list.html">get_liver_om_lb_mi_tox_score_list</a></li>
    <li><a class="dropdown-item" href="../articles/get_col_harmonized_scores_df.html">get_col_harmonized_scores_df</a></li>
    <li><a class="dropdown-item" href="../articles/get_ml_data_and_tuned_hyperparameters.html">get_ml_data_and_tuned_hyperparameters</a></li>
    <li><a class="dropdown-item" href="../articles/get_rf_model_with_cv.html">get_rf_model_with_cv</a></li>
    <li><a class="dropdown-item" href="../articles/get_zone_exclusioned_rf_model_with_cv.html">get_zone_exclusioned_rf_model_with_cv</a></li>
    <li><a class="dropdown-item" href="../articles/get_imp_features_from_rf_model_with_cv.html">get_imp_features_from_rf_model_with_cv</a></li>
    <li><a class="dropdown-item" href="../articles/get_auc_curve_with_rf_model.html">get_auc_curve_with_rf_model</a></li>
    <li><a class="dropdown-item" href="../articles/get_histogram_barplot.html">get_histogram_barplot</a></li>
    <li><a class="dropdown-item" href="../articles/get_reprtree_from_rf_model.html">get_reprtree_from_rf_model</a></li>
    <li><a class="dropdown-item" href="../articles/get_prediction_plot.html">get_prediction_plot</a></li>
    <li><a class="dropdown-item" href="../articles/get_Data_formatted_for_ml_and_best.m.html">get_Data_formatted_for_ml_and_best.m</a></li>
    <li><a class="dropdown-item" href="../articles/get_rf_input_param_list_output_cv_imp.html">get_rf_input_param_list_output_cv_imp</a></li>
    <li><a class="dropdown-item" href="../articles/get_zone_exclusioned_rf_model_cv_imp.html">get_zone_exclusioned_rf_model_cv_imp</a></li>
    <li><a class="dropdown-item" href="../articles/get_repeat_dose_parallel_studyids.html">get_repeat_dose_parallel_studyids</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aminuldu07/SENDQSAR" aria-label="github"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Random Forest Model with Cross-Validation and Feature Importance</h1>
                        <h4 data-toc-skip class="author">Md Aminul Islam
Prodhan</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/aminuldu07/SENDQSAR/blob/HEAD/vignettes/get_zone_exclusioned_rf_model_cv_imp.Rmd" class="external-link"><code>vignettes/get_zone_exclusioned_rf_model_cv_imp.Rmd</code></a></small>
      <div class="d-none name"><code>get_zone_exclusioned_rf_model_cv_imp.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="function-purpose">Function Purpose<a class="anchor" aria-label="anchor" href="#function-purpose"></a>
</h3>
<p>The <code>get_rf_model_output_cv_imp</code> function is designed to
perform cross-validation on a Random Forest model, track performance
metrics (such as sensitivity, specificity, accuracy), handle
indeterminate predictions, and compute feature importance based on
either Gini or Accuracy. This function outputs performance summaries and
feature importance rankings after a specified number of test
repetitions.</p>
</div>
<div class="section level3">
<h3 id="input-parameters">Input Parameters<a class="anchor" aria-label="anchor" href="#input-parameters"></a>
</h3>
<p>The function takes several input parameters that control the model’s
training process, validation, and feature importance calculations. Below
is a table describing each parameter:</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="9%">
<col width="78%">
</colgroup>
<thead><tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>scores_df</code></td>
<td><code>data.frame</code></td>
<td>A data frame containing the features and target variable for
training and testing the model.</td>
</tr>
<tr class="even">
<td><code>Undersample</code></td>
<td><code>logical</code></td>
<td>A flag indicating whether to apply undersampling to the training
data. Defaults to <code>FALSE</code>.</td>
</tr>
<tr class="odd">
<td><code>best.m</code></td>
<td>
<code>numeric</code> / <code>NULL</code>
</td>
<td>A numeric value representing the number of features to sample for
the Random Forest model, or <code>NULL</code> to calculate it
automatically.</td>
</tr>
<tr class="even">
<td><code>testReps</code></td>
<td><code>integer</code></td>
<td>The number of repetitions for cross-validation. This should be at
least 2.</td>
</tr>
<tr class="odd">
<td><code>indeterminateUpper</code></td>
<td><code>numeric</code></td>
<td>The upper threshold for considering a prediction as indeterminate
(e.g., a probability below this value is deemed indeterminate).</td>
</tr>
<tr class="even">
<td><code>indeterminateLower</code></td>
<td><code>numeric</code></td>
<td>The lower threshold for considering a prediction as indeterminate
(e.g., a probability above this value is deemed indeterminate).</td>
</tr>
<tr class="odd">
<td><code>Type</code></td>
<td><code>integer</code></td>
<td>The type of importance to compute (<code>1</code> for
MeanDecreaseAccuracy, <code>2</code> for MeanDecreaseGini).</td>
</tr>
<tr class="even">
<td><code>nTopImportance</code></td>
<td><code>integer</code></td>
<td>The number of top features to display based on their importance
scores.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p>The function returns a list containing the following elements:</p>
<ul>
<li>
<strong><code>performance_metrics</code></strong>: A vector of
aggregated performance metrics (e.g., sensitivity, specificity,
accuracy, etc.).</li>
<li>
<strong><code>feature_importance</code></strong>: A matrix
containing the importance of the top <code>nTopImportance</code>
features, ordered by their importance score.</li>
<li>
<strong><code>raw_results</code></strong>: A list containing raw
results for debugging or further analysis, including sensitivity,
specificity, accuracy, and Gini scores across all test repetitions.</li>
</ul>
</div>
<div class="section level3">
<h3 id="key-steps">Key Steps<a class="anchor" aria-label="anchor" href="#key-steps"></a>
</h3>
<div class="section level4">
<h4 id="data-preparation">1. Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h4>
<p>The input data is prepared by creating a copy of
<code>scores_df</code> called <code>rfTestData</code>, which is then
initialized with <code>NA</code> values to hold predictions from each
test repetition. The column names are simplified to numeric
identifiers.</p>
</div>
<div class="section level4">
<h4 id="cross-validation">2. Cross-Validation<a class="anchor" aria-label="anchor" href="#cross-validation"></a>
</h4>
<p>The function iterates through <code>testReps</code> repetitions to
perform cross-validation:</p>
<ul>
<li>The dataset is split into training and testing sets in each
iteration.</li>
<li>If <code>Undersample</code> is set to <code>TRUE</code>, the
training set is undersampled to balance the class distribution.</li>
<li>A Random Forest model is trained on the training data.</li>
<li>Predictions are made on the test data and stored in
<code>rfTestData</code>.</li>
</ul>
</div>
<div class="section level4">
<h4 id="handling-indeterminate-predictions">3. Handling Indeterminate Predictions<a class="anchor" aria-label="anchor" href="#handling-indeterminate-predictions"></a>
</h4>
<p>During each repetition, predictions with probabilities between the
<code>indeterminateUpper</code> and <code>indeterminateLower</code>
thresholds are considered indeterminate. These predictions are replaced
with <code>NA</code>, and the proportion of indeterminate predictions is
tracked.</p>
</div>
<div class="section level4">
<h4 id="performance-metrics">4. Performance Metrics<a class="anchor" aria-label="anchor" href="#performance-metrics"></a>
</h4>
<p>For each test repetition, the function computes a confusion matrix
using the <code>caret</code> package and extracts various performance
metrics, including:</p>
<ul>
<li>Sensitivity</li>
<li>Specificity</li>
<li>Positive Predictive Value (PPV)</li>
<li>Negative Predictive Value (NPV)</li>
<li>Prevalence</li>
<li>Accuracy</li>
</ul>
<p>These metrics are stored and aggregated across all test repetitions
to provide an overall performance summary.</p>
</div>
<div class="section level4">
<h4 id="feature-importance">5. Feature Importance<a class="anchor" aria-label="anchor" href="#feature-importance"></a>
</h4>
<p>The feature importance is computed using the
<code><a href="https://rdrr.io/pkg/randomForest/man/importance.html" class="external-link">randomForest::importance()</a></code> function. The importance scores
are aggregated over all repetitions, and the top
<code>nTopImportance</code> features are identified and returned.</p>
</div>
<div class="section level4">
<h4 id="return-results">6. Return Results<a class="anchor" aria-label="anchor" href="#return-results"></a>
</h4>
<p>The function returns a list containing:</p>
<ul>
<li>Aggregated performance metrics</li>
<li>Top <code>nTopImportance</code> features ranked by their importance
score</li>
<li>Raw results for further analysis (e.g., confusion matrix
outputs)</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="example-usage">Example Usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h3>
<p>```r # Example usage of the function result &lt;-
get_rf_model_output_cv_imp( scores_df = your_data, Undersample = FALSE,
best.m = 3, testReps = 5, indeterminateUpper = 0.8, indeterminateLower =
0.2, Type = 1, nTopImportance = 10 )</p>
</div>
<div class="section level2">
<h2 id="view-performance-metrics">View performance metrics<a class="anchor" aria-label="anchor" href="#view-performance-metrics"></a>
</h2>
<p>print(result$performance_metrics)</p>
</div>
<div class="section level2">
<h2 id="view-top-features-by-importance">View top features by importance<a class="anchor" aria-label="anchor" href="#view-top-features-by-importance"></a>
</h2>
<p>print(result$feature_importance)</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Md Aminul Islam Prodhan, Kevin Snyder.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
