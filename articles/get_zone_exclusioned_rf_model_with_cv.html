<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Random Forest Model with Cross-validation and Exclusion • SENDQSAR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Random Forest Model with Cross-validation and Exclusion">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SENDQSAR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/get_compile_data.html">get_compile_data</a></li>
    <li><a class="dropdown-item" href="../articles/get_bw_score.html">get_bw_score</a></li>
    <li><a class="dropdown-item" href="../articles/get_livertobw_score.html">get_livertobw_score</a></li>
    <li><a class="dropdown-item" href="../articles/get_lb_score.html">get_lb_score</a></li>
    <li><a class="dropdown-item" href="../articles/get_mi_score.html">get_mi_score</a></li>
    <li><a class="dropdown-item" href="../articles/get_liver_om_lb_mi_tox_score_list.html">get_liver_om_lb_mi_tox_score_list</a></li>
    <li><a class="dropdown-item" href="../articles/get_col_harmonized_scores_df.html">get_col_harmonized_scores_df</a></li>
    <li><a class="dropdown-item" href="../articles/get_ml_data_and_tuned_hyperparameters.html">get_ml_data_and_tuned_hyperparameters</a></li>
    <li><a class="dropdown-item" href="../articles/get_rf_model_with_cv.html">get_rf_model_with_cv</a></li>
    <li><a class="dropdown-item" href="../articles/get_zone_exclusioned_rf_model_with_cv.html">get_zone_exclusioned_rf_model_with_cv</a></li>
    <li><a class="dropdown-item" href="../articles/get_imp_features_from_rf_model_with_cv.html">get_imp_features_from_rf_model_with_cv</a></li>
    <li><a class="dropdown-item" href="../articles/get_auc_curve_with_rf_model.html">get_auc_curve_with_rf_model</a></li>
    <li><a class="dropdown-item" href="../articles/get_histogram_barplot.html">get_histogram_barplot</a></li>
    <li><a class="dropdown-item" href="../articles/get_reprtree_from_rf_model.html">get_reprtree_from_rf_model</a></li>
    <li><a class="dropdown-item" href="../articles/get_prediction_plot.html">get_prediction_plot</a></li>
    <li><a class="dropdown-item" href="../articles/get_Data_formatted_for_ml_and_best.m.html">get_Data_formatted_for_ml_and_best.m</a></li>
    <li><a class="dropdown-item" href="../articles/get_rf_input_param_list_output_cv_imp.html">get_rf_input_param_list_output_cv_imp</a></li>
    <li><a class="dropdown-item" href="../articles/get_zone_exclusioned_rf_model_cv_imp.html">get_zone_exclusioned_rf_model_cv_imp</a></li>
    <li><a class="dropdown-item" href="../articles/get_repeat_dose_parallel_studyids.html">get_repeat_dose_parallel_studyids</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aminuldu07/SENDQSAR" aria-label="github"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Random Forest Model with Cross-validation and Exclusion</h1>
                        <h4 data-toc-skip class="author">Your Name</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/aminuldu07/SENDQSAR/blob/main/vignettes/get_zone_exclusioned_rf_model_with_cv.Rmd" class="external-link"><code>vignettes/get_zone_exclusioned_rf_model_with_cv.Rmd</code></a></small>
      <div class="d-none name"><code>get_zone_exclusioned_rf_model_with_cv.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>get_zone_exclusioned_rf_model_with_cv</code> function
implements a Random Forest classification model with cross-validation.
It provides tools for evaluating the model’s performance, including
sensitivity, specificity, accuracy, and other metrics. The function
allows users to handle indeterminate predictions and includes an option
for undersampling the data, which can be particularly useful when
dealing with imbalanced datasets.</p>
<p>This document explains how to use the function, describes its inputs,
outputs, and the key steps involved in the model training and evaluation
process.</p>
</div>
<div class="section level2">
<h2 id="function-purpose">Function Purpose<a class="anchor" aria-label="anchor" href="#function-purpose"></a>
</h2>
<p>The main goal of this function is to train a Random Forest model and
evaluate it using cross-validation. The function:</p>
<ul>
<li>Performs cross-validation across a specified number of repetitions
(<code>testReps</code>).</li>
<li>Allows for undersampling of the dataset to address class imbalance
if required.</li>
<li>Handles indeterminate predictions by setting them to
<code>NA</code>.</li>
<li>Tracks performance metrics like sensitivity, specificity, positive
predictive value (PPV), and accuracy for each repetition.</li>
<li>Provides an aggregated summary of performance metrics across all
repetitions.</li>
</ul>
<p>Additionally, the function provides an option to adjust the feature
importance calculation, either using the Gini index or the Mean Decrease
Accuracy.</p>
</div>
<div class="section level2">
<h2 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h2>
<p>The function accepts the following parameters:</p>
<ul>
<li><p><strong>Data</strong> (<code>Data</code>): A data frame
containing the features and the target variable
(<code>Target_Organ</code>) to train the model on.</p></li>
<li><p><strong>Undersample</strong> (<code>Undersample</code>): A
boolean parameter that indicates whether to perform undersampling on the
data to balance the class distribution. If set to <code>TRUE</code>, the
function will undersample the negative class to match the number of
positive class instances.</p></li>
<li><p><strong>Best Model Parameter</strong> (<code>best.m</code>): A
numeric value indicating the best number of variables
(<code>mytry</code>) to use at each split in the Random Forest model.
This value can be provided manually or determined through
optimization.</p></li>
<li><p><strong>Test Repetitions</strong> (<code>testReps</code>): The
number of times to repeat the cross-validation process. This value must
be at least 2, as the function relies on multiple test sets to assess
model performance.</p></li>
<li><p><strong>Indeterminate Prediction Thresholds</strong>
(<code>indeterminateUpper</code>, <code>indeterminateLower</code>):
These parameters define the upper and lower bounds for predicting
“indeterminate” values. If a model’s predicted probability falls between
these thresholds, the prediction is considered indeterminate and set to
<code>NA</code>.</p></li>
<li><p><strong>Feature Importance Type</strong> (<code>Type</code>): An
integer indicating the type of feature importance to use in the Random
Forest model. Typically, this will be either <code>1</code> for “Mean
Decrease Accuracy” or <code>2</code> for “Mean Decrease Gini”.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="model-workflow">Model Workflow<a class="anchor" aria-label="anchor" href="#model-workflow"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Data Preparation</strong>:
<ul>
<li>The input data frame (<code>Data</code>) is processed to ensure that
it is formatted correctly for model training. The column names are
simplified to numeric identifiers for easier manipulation.</li>
</ul>
</li>
<li>
<strong>Cross-validation</strong>:
<ul>
<li>The function performs cross-validation, repeating the training and
testing process for the specified number of repetitions
(<code>testReps</code>). In each repetition:
<ul>
<li>The dataset is split into a training set and a test set, with each
iteration using different random samples.</li>
<li>The Random Forest model is trained on the training set, and
predictions are made on the test set.</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>Undersampling (Optional)</strong>:
<ul>
<li>If <code>Undersample</code> is set to <code>TRUE</code>, the
function balances the dataset by undersampling the negative class. The
positive class is left unchanged, and the negative class is reduced to
match the size of the positive class.</li>
</ul>
</li>
<li>
<strong>Prediction and Evaluation</strong>:
<ul>
<li>After training the model, predictions are made on the test data. The
predicted probabilities are stored and later used to calculate
performance metrics.</li>
<li>Indeterminate predictions are identified based on the upper and
lower thresholds (<code>indeterminateUpper</code> and
<code>indeterminateLower</code>). These predictions are marked as
<code>NA</code> and not included in performance calculations.</li>
</ul>
</li>
<li>
<strong>Performance Metrics</strong>:
<ul>
<li>For each repetition, the function calculates various performance
metrics, including:
<ul>
<li>
<strong>Sensitivity</strong>: The proportion of true positives
correctly identified by the model.</li>
<li>
<strong>Specificity</strong>: The proportion of true negatives
correctly identified by the model.</li>
<li>
<strong>Accuracy</strong>: The overall accuracy of the model in
predicting both classes.</li>
<li>
<strong>PPV (Positive Predictive Value)</strong>: The proportion of
positive predictions that are correct.</li>
<li>
<strong>NPV (Negative Predictive Value)</strong>: The proportion of
negative predictions that are correct.</li>
<li>
<strong>Prevalence</strong>: The proportion of positive cases in the
dataset.</li>
</ul>
</li>
<li>These metrics are computed using the <code>caret</code> package’s
confusion matrix function.</li>
</ul>
</li>
<li>
<strong>Aggregated Results</strong>:
<ul>
<li>After completing all test repetitions, the function calculates the
mean of each performance metric across all repetitions to provide an
aggregated performance summary.</li>
<li>The results include both individual metrics for each repetition and
the overall performance summary.</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="outputs">Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a>
</h2>
<p>The function returns a list with two components:</p>
<ol style="list-style-type: decimal">
<li><p><strong>performance_metrics</strong>: A vector containing the
aggregated performance metrics (mean sensitivity, specificity, accuracy,
etc.) calculated across all test repetitions.</p></li>
<li>
<p><strong>raw_results</strong>: A list containing the raw
performance metrics for each repetition, including:</p>
<ul>
<li>
<code>sensitivity</code>: A vector of sensitivity values for each
test repetition.</li>
<li>
<code>specificity</code>: A vector of specificity values for each
test repetition.</li>
<li>
<code>accuracy</code>: A vector of accuracy values for each test
repetition.</li>
</ul>
</li>
</ol>
<p>These outputs can be used to evaluate the model’s performance and
further analyze the results.</p>
</div>
<div class="section level2">
<h2 id="example-usage">Example Usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h2>
<p>Below is an example of how to use the function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example dataset (replace with actual data)</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="va">your_data_frame</span></span>
<span></span>
<span><span class="co"># Run the model with cross-validation and undersampling</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_zone_exclusioned_rf_model_with_cv.html">get_zone_exclusioned_rf_model_with_cv</a></span><span class="op">(</span>Data <span class="op">=</span> <span class="va">Data</span>,</span>
<span>                                                Undersample <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                                best.m <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                                testReps <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                                                indeterminateUpper <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                                                indeterminateLower <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                                                Type <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the aggregated performance metrics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">performance_metrics</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access raw results for further analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">raw_results</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Md Aminul Islam Prodhan, Kevin Snyder.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
